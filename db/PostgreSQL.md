# PostgreSQL

## Roles

### Create ROLE DBA
```bash
CREATE ROLE dba WITH SUPERUSER;
GRANT USAGE ON SCHEMA CLINICA TO dba;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA CLINICA TO dba WITH GRANT OPTION;
```

### Create ROLE JEFE ESPECIALISTA
```bash
CREATE ROLE jefe_especialista;
GRANT USAGE ON SCHEMA CLINICA TO jefe_especialista;
GRANT SELECT, INSERT, UPDATE ON CLINICA.EXPEDIENTE, CLINICA.EXPEDIENTE_DIAGNOSTICO, CLINICA.ESPECIALISTA TO jefe_especialista WITH GRANT OPTION;
GRANT DELETE ON CLINICA.ESPECIALISTA TO jefe_especialista WITH GRANT OPTION;
```

### Create ROLE ESPECIALISTA
```bash
CREATE ROLE especialista;
GRANT USAGE ON SCHEMA CLINICA TO especialista;
GRANT SELECT, INSERT, UPDATE ON CLINICA.EXPEDIENTE, CLINICA.EXPEDIENTE_DIAGNOSTICO TO especialista WITH GRANT OPTION;
GRANT SELECT ON CLINICA.PACIENTE TO especialista WITH GRANT OPTION;
```


### Create ROLE RECEPCIONISTA
```bash
CREATE ROLE recepcionista;
GRANT USAGE ON SCHEMA CLINICA TO recepcionista;
GRANT SELECT, INSERT, UPDATE ON CLINICA.PACIENTE, CLINICA.CITA, CLINICA.AGENDAR_CITA TO recepcionista WITH GRANT OPTION;
GRANT DELETE ON CLINICA.PACIENTE TO recepcionista WITH GRANT OPTION;
```

### Eliminar un ROL
```bash
DROP OWNED BY user_service CASCADE;
DROP ROLE user_service;
```


## User

### Create Users
```bash
CREATE USER administrador WITH PASSWORD '12345' IN ROLE dba;
CREATE USER jefe_especialista_1 WITH PASSWORD '12345' CONNECTION LIMIT 1 IN ROLE jefe_especialista;
CREATE USER especialista_1 WITH PASSWORD '12345' CONNECTION LIMIT 1 IN ROLE especialista;
CREATE USER especialista_2 WITH PASSWORD '12345' CONNECTION LIMIT 1 IN ROLE especialista;
CREATE USER especialista_3 WITH PASSWORD '12345' CONNECTION LIMIT 1 IN ROLE especialista;
CREATE USER recepcionista_1 WITH PASSWORD '12345' CONNECTION LIMIT 1 IN ROLE recepcionista;
CREATE USER recepcionista_2 WITH PASSWORD '12345' CONNECTION LIMIT 1 IN ROLE recepcionista;
CREATE USER recepcionista_3 WITH PASSWORD '12345' CONNECTION LIMIT 1 IN ROLE recepcionista;
```

### REVOCAR PERMISOS, BORRAR USUARIOS Y ROLES
```bash
DROP USER recepcionista_3;
REVOKE SELECT, INSERT, UPDATE ON CLINICA.PACIENTE, CLINICA.CITA, CLINICA.AGENDAR_CITA FROM recepcionista;
REVOKE DELETE ON CLINICA.PACIENTE FROM recepcionista;
REVOKE USAGE ON SCHEMA CLINICA FROM recepcionista;
DROP ROLE recepcionista;
```

### Example the user service (svc_application_tipo_ambiente)
```bash
svc_crm_writer_prod
svc_erp_reader_qa
svc_etl_ingestion_stage
svc_bi_api_dev
```

# Crear usuarios de servicio

### Crear Role
```bash
CREATE ROLE user_service;
GRANT USAGE ON SCHEMA clinica TO user_service;
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA clinica TO user_service;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA clinica TO user_service;
GRANT EXECUTE ON ALL FUNCTIONS IN SCHEMA clinica TO user_service;
```

### Create User
```bash
CREATE USER svc_microservicios_write_dev WITH PASSWORD '12345' IN ROLE user_service;
CREATE USER svc_microservicios_write_qa WITH PASSWORD '12345' IN ROLE user_service;
CREATE USER svc_microservicios_write_pro WITH PASSWORD '12345' IN ROLE user_service;
````

# FUNCTION

### Plantilla
```bash
CREATE FUNCTION nameFunction() RETURNS datatype
AS $$BEGIN
END;
$$ LANGUAGE plpgsql;
```


